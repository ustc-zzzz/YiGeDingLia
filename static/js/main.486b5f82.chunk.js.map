{"version":3,"sources":["index.tsx"],"names":["getFirstPinyin","data","pinyin","split","shift","replace","getLastPinyin","pop","indexed","json","result","firstPinyin","lastPinyin","word","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","Symbol","iterator","next","done","value","endsWith","length","key1","values1","push","key2","values2","err","return","pinyins","Set","_loop","level","newpinyins","forEach","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","add","console","log","concat","size","show","idiom","handle","input","state","_loop2","v","filtered","filter","d","Math","floor","random","_ret","copyText","text","dt","Clipboard","DT","setData","write","Loading","props","error","react__WEBPACK_IMPORTED_MODULE_1___default","a","createElement","style","color","Input","type","onChange","e","target","Output","seq","map","className","onClick","key","Footer","href","ReactDOM","render","resolve","reject","_React$useState","React","useState","_React$useState2","Object","_home_travis_build_ustc_zzzz_YiGeDingLia_node_modules_babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_0__","setState","_React$useState3","_React$useState4","setError","_React$useState5","_React$useState6","setSeq","keys","fetch","then","r","j","catch","document","getElementsByTagName"],"mappings":"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","file":"static/js/main.486b5f82.chunk.js","sourcesContent":["import React from 'react'\nimport ReactDOM from 'react-dom'\nimport Clipboard from 'clipboard-polyfill'\n\nimport './index.css'\nimport './github-markdown.css'\n\ntype ErrorMsg = string\n\ntype Idiom = {\n  word: string,\n  pinyin: string,\n}\n\ntype Data = Idiom & {\n  abbreviation: string\n  derivation: string\n  example: string\n  explanation: string\n  level?: number\n}\n\ninterface State {\n  firstPinyin: {\n    [key: string]: Data[]\n  }\n  lastPinyin: {\n    [key: string]: Data[]\n  }\n  word: {\n    [key: string]: Data\n  }\n}\n\nconst getFirstPinyin = (data: Data) => {\n  return (data.pinyin.split(/\\s+/).shift() || '')\n    .replace(/[āáǎà]/g, 'a').replace(/[ōóǒò]/g, 'o').replace(/[ēéěèê]/g, 'e')\n    .replace(/[īíǐì]/g, 'i').replace(/[ūúǔù]/g, 'u').replace(/[ǖǘǚǜü]/g, 'v')\n}\n\nconst getLastPinyin = (data: Data) => {\n  return (data.pinyin.split(/\\s+/).pop() || '')\n    .replace(/[āáǎà]/g, 'a').replace(/[ōóǒò]/g, 'o').replace(/[ēéěèê]/g, 'e')\n    .replace(/[īíǐì]/g, 'i').replace(/[ūúǔù]/g, 'u').replace(/[ǖǘǚǜü]/g, 'v')\n}\n\nconst fix = (data: Data) => {\n  if ('味同嚼蜡' === data.word) {\n    data.pinyin = data.pinyin.replace('cù', 'là')\n  }\n  if (data.word.endsWith('俩')) {\n    data.pinyin = data.pinyin.replace('liǎng', 'liǎ')\n  }\n  data.pinyin = data.pinyin.replace(/yi([ēéěèêe])/g, 'y$1')\n  return data\n}\n\nconst indexed = (json: Data[]) => {\n  const result: State = { firstPinyin: {}, lastPinyin: {}, word: {} }\n  for (const data of json) {\n    fix(data)\n    if (data.word.length === 4) {\n      const key1 = getLastPinyin(data)\n      const values1 = result.lastPinyin[key1] || []\n      result.lastPinyin[key1] = values1\n      values1.push(data)\n\n      const key2 = getFirstPinyin(data)\n      const values2 = result.firstPinyin[key2] || []\n      result.firstPinyin[key2] = values2\n      values2.push(data)\n\n      result.word[data.word] = data\n    }\n  }\n  let pinyins = new Set(['yi'])\n  for (let level = 1; pinyins.size > 0; ++level) {\n    const newpinyins = new Set<string>()\n    pinyins.forEach(pinyin => {\n      for (const data of result.lastPinyin[pinyin] || []) {\n        if (!data.level) {\n          data.level = level\n          newpinyins.add(getFirstPinyin(data))\n        }\n      }\n    })\n    console.log(`Generate ${newpinyins.size} entries for level ${level}`)\n    pinyins = newpinyins\n  }\n  return result\n}\n\nconst show = (idiom: Idiom) => {\n  const pinyin = idiom.pinyin.replace(/\\s+([aāáǎàoōóǒòeēéěèê])/g, '\\'$1').replace(/\\s+/g, '')\n  return `${idiom.word}（${pinyin}）`\n}\n\nconst handle = (input: string, state: State) => {\n  const result: Idiom[] = []\n  let data = state.word[input]\n  while (data && data.level) {\n    const level = data.level\n    result.push(data)\n    if (level > 1) {\n      const next = state.firstPinyin[getLastPinyin(data)]\n      const filtered = next.filter(d => d.level && d.level < level)\n      data = filtered[Math.floor(Math.random() * filtered.length)]\n    } else {\n      result.push({ word: '一个顶俩', pinyin: 'yī gè dǐng liǎ' })\n      return result\n    }\n  }\n  return result\n}\n\nfunction fetchJson(resolve: (data: State) => void, reject: (error: ErrorMsg) => void) {\n  const url = 'https://cdn.jsdelivr.net/gh/pwxcoo/chinese-xinhua/data/idiom.json'\n  fetch(url).then(r => r.json()).then(j => resolve(indexed(j))).catch(e => reject('' + e))\n}\n\nfunction copyText(text: string) {\n  return () => {\n    const dt = new Clipboard.DT()\n    dt.setData('text/plain', text)\n    Clipboard.write(dt)\n  }\n}\n\nfunction Loading(props: { error: ErrorMsg }) {\n  if (props.error === '') {\n    return <p>数据加载中...</p>\n  } else {\n    return <p style={{ color: 'red' }}>{`数据加载中...加载异常，请刷新重试：${props.error}`}</p>\n  }\n}\n\nfunction Input(props: { onChange(value: string): void }) {\n  return <div>\n    <p>请输入一个四字成语，<wbr />如成功识别：</p>\n    <p>本页面将自动为你<wbr />接龙到“一个顶俩”</p>\n    <p><input type='input' onChange={e => props.onChange(e.target.value)} /></p>\n  </div>\n}\n\nfunction Output(props: { copyText(word: string): () => void, seq: Idiom[] }) {\n  if (props.seq.length > 0) {\n    return <div>\n      <p>点击成语可以直接复制：</p>\n      <ul>{props.seq.map(data => {\n        return <li className='clickable' onClick={props.copyText(data.word)} key={data.word}>\n          {show(data)}\n        </li>\n      })}</ul>\n    </div>\n  } else {\n    return <div>\n      <p>没有输出？<wbr />情况可能是以下两种之一：</p>\n      <ul>\n        <li>不是四字成语，<wbr />或成语在词库中不存在</li>\n        <li>成语存在，<wbr />但是无法接龙到“一个顶俩”</li>\n      </ul>\n    </div>\n  }\n}\n\nfunction Footer() {\n  return <div>\n    <p>\n      网页来源：<wbr />\n      <a href='https://github.com/ustc-zzzz/yigedinglia'>ustc-zzzz/yigedinglia</a>\n    </p>\n    <p>\n      数据来源：<wbr />\n      <a href='https://github.com/pwxcoo/chinese-xinhua'>pwxcoo/chinese-xinhua</a>\n    </p>\n  </div>\n}\n\nfunction App() {\n  const [state, setState] = React.useState<State>({ firstPinyin: {}, lastPinyin: {}, word: {} })\n  const [error, setError] = React.useState<ErrorMsg>('')\n  const [seq, setSeq] = React.useState<Idiom[]>([])\n\n  if (Object.keys(state.word).length > 0) {\n    return <div className='markdown-body'>\n      <h1>一个顶俩</h1>\n      <Input onChange={value => setSeq(handle(value, state))} />\n      <Output seq={seq} copyText={copyText} />\n      <Footer />\n    </div>\n  } else {\n    fetchJson(setState, setError)\n    return <div className='markdown-body'>\n      <h1>一个顶俩</h1>\n      <Loading error={error} />\n      <Footer />\n    </div>\n  }\n}\n\nReactDOM.render(<App />, document.getElementsByTagName('main')[0])\n"],"sourceRoot":""}